angular.module("starter.services",[]).constant("ApiConfig",{wsKey:void 0!==window.localStorage.restPass?window.localStorage.restPass:"mypassword",ovpEndpoint:"http://api.overplace.com/rest/application/",ovpEndpointHmac:"http://api.overplace.com/rest/v1/"}).constant("Cache",{convalideCache:[],convalideCacheAll:[],convalideCacheId:{},convalideRemovedCache:[],notificheCache:[],notificheCacheId:{},notificheCacheRead:{}}).factory("NavBadges",["$http",function(){var e={};return e.badges={notifiche:0,convalide:0,chat:0},e.setBadges=function(n,r){e.badges[n]=window.localStorage["nr_"+n]=r},e.getBadges=function(){return e.badges},e}]).factory("Auth",["$http","$q","$cordovaFileTransfer","ApiConfig","PushState","Chats","Cache",function(e,n,r,t,o,a,c){var i=this;return this.clearLocalStorage=function(){window.localStorage.clear()},{login:function(a,c){var i=n.defer(),d={username:a,password:c};return d[t.wsKey]="JSON_CALLBACK",e({method:"JSONP",url:t.ovpEndpoint+"login",params:d,cache:!1}).success(function(e){var n=e.filename,t=n.split("/").pop(),a=cordova.file.dataDirectory+t,c=!0,d={};e.filepath=a,r.download(n,a,d,c).then(function(){o.register(e).then(function(){return i.resolve(e)},function(){return i.reject()})},function(){return i.reject()})}).error(function(){return i.reject()})},logout:function(){var e=n.defer();return o.unregister().then(function(n){return i.clearLocalStorage(),a.unsubscribeChannels(),c.convalideCache=[],c.convalideCacheAll=[],c.convalideCacheId={},c.convalideRemovedCache=[],c.notificheCache=[],c.notificheCacheId={},c.notificheCacheRead={},c.newsCache=[],c.newsCacheId={},e.resolve(n)},function(){return e.reject()})},storeAuthInfo:function(e){window.localStorage.id_scheda=e.id_scheda,window.localStorage.user=JSON.stringify(e),window.localStorage.enablePushNotifications=!0,window.localStorage.chatAvailable="1"==e.chat?!0:!1}}}]).factory("PushState",["$http","$q","$cordovaPush","$cordovaDevice","ApiConfig",function(e,n,r,t,o){var a=this,c=null,i=null,d=null;return ionic.Platform.isAndroid()?c={senderID:"751872435382"}:ionic.Platform.isIOS()&&(c={badge:"true",sound:"true",alert:"true"}),this.storeDeviceToken=function(r){d=window.localStorage.id_scheda,i=window.localStorage.regId;var a=n.defer(),c={regid:i,uuid:t.getUUID(),so_type:t.getPlatform()};return c[o.wsKey]="JSON_CALLBACK",e({method:"JSONP",url:o.ovpEndpoint+"reg/"+d+"/"+r+"/fields",params:c,cache:!1}).success(function(e){return a.resolve(e)}).error(function(){return a.reject()})},{register:function(e){var t=n.defer();return d=e.id_scheda,r.register(c).then(function(e){return ionic.Platform.isIOS()&&(i=e,window.localStorage.regId=i,a.storeDeviceToken("registration")),t.resolve(e)},function(){return t.reject()})},unregister:function(){var e=n.defer();return a.storeDeviceToken("unregistration").then(function(n){return e.resolve(n)},function(){return e.reject()})},handleAndroid:function(e){var r=n.defer();return i=e.regid,window.localStorage.regId=i,d=window.localStorage.id_scheda,a.storeDeviceToken("registration").then(function(e){return r.resolve(e)},function(){return r.reject()})},handleIOS:function(){return null},serverNotificationsCallback:function(){var n={regid:window.localStorage.regId},r=o.ovpEndpoint+"notification/cb/"+window.localStorage.id_scheda+"/fields";n[o.wsKey]="JSON_CALLBACK",e({method:"JSONP",url:r,params:n,cache:!1}).success(function(){}).error(function(){}).then(function(){})},toggleChat:function(e){var r=n.defer();i=window.localStorage.regId;var t=e===!0?"enable_chat":"disable_chat";return a.storeDeviceToken(t).then(function(e){return r.resolve(e)},function(){return r.reject()})},getFromRifId:function(r){var t=n.defer(),c={refId:r},i=o.ovpEndpoint+"notification/get/"+window.localStorage.id_scheda+"/fields";return c[o.wsKey]="JSON_CALLBACK",e({method:"JSONP",url:i,params:c,cache:!1}).success(function(e){return a.reference=e,t.resolve(e)}).error(function(){return t.reject()})},getReference:function(){return a.reference}}}]);