angular.module("eventi.controllers",[]).controller("EventiCtrl",["$scope","$ionicPopup","$ionicLoading","$cordovaToast","$location","$timeout","Eventi",function(e,t,o,n,i,a,r){e.eventi_list=[],e.isAvailable=!0,e.loadEventi=function(){r.loadMore().then(function(t){e.eventi_list=t,e.isAvailable=r.getMoreStatus(),e.$broadcast("scroll.infiniteScrollComplete")},function(){n.show("Attenzione! Si è verificato un errore durante il caricamento","short","bottom"),e.$broadcast("scroll.infiniteScrollComplete")})},e.delete=function(e){var i="Sei sicuro di voler cancellare l'evento?";e.twitter&&(i+=" Verrà eliminato anche il post su Twitter.");var a=t.confirm({title:"Attenzione",template:i,okText:"Si",cancelText:"No"});a.then(function(t){t&&(o.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),r.delete(e).then(function(){o.hide(),n.show("Evento eliminato con successo","short","bottom")},function(){o.hide(),n.show("Errore eliminazione evento","short","bottom")}))})},e.edit=function(e){i.path("/app/eventi/"+e+"/edit")},e.refresh=function(){r.refreshList().then(function(t){e.eventi_list=t,e.isAvailable=r.getMoreStatus(),e.$broadcast("scroll.refreshComplete")},function(){n.show("Errore nel recupero degli eventi!","short","bottom"),e.$broadcast("scroll.refreshComplete")})}}]).controller("EventiDetailCtrl",["$scope","$stateParams","$ionicHistory","$ionicPopup","$ionicLoading","$cordovaToast","Eventi",function(e,t,o,n,i,a,r){e.eventi_list=r.getList(),e.evento=r.get(t.id),e.delete=function(e){var t="Sei sicuro di voler cancellare l'evento?";e.twitter&&(t+=" Verrà eliminato anche il post su Twitter.");var c=n.confirm({title:"Attenzione",template:t,okText:"Si",cancelText:"No"});c.then(function(t){t&&(i.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),r.delete(e).then(function(){i.hide(),o.goBack(),a.show("Evento eliminato con successo","short","bottom")},function(){i.hide(),a.show("Errore eliminazione evento","short","bottom")}))})}}]).controller("EventiOperationCtrl",["$scope","$stateParams","$cordovaDatePicker","$cordovaCamera","$ionicLoading","$cordovaToast","$ionicPopup","$ionicHistory","$timeout","Auth","Eventi","ListeContatti",function(e,t,o,n,i,a,r,c,s,l,d){var m=l.getUserData(null);e.social=m.wmc_data.social,e.notifiche={messaggi:m.wmc_data.messaggi,app:m.wmc_data.app},e.notifiche_checkbox={email:0,sms:0},e.emptyListaContatti={email_disabled:!1,sms_disabled:!1};var u=c.currentView(),v=!1;switch(u.stateName){case"app.eventi-create":e.evento=[],e.evento.twitter=!1,e.evento.data_inizio_evento=(new Date).getTime();var p=new Date;p.setDate(p.getDate()+1),e.evento.data_fine_evento=p.getTime(),e.evento.filename=m.filename.replace("/lg_","/xl_"),e.evento.notifiche={pendenti:{email:0}};break;case"app.eventi-edit":e.evento=d.get(t.id);var h=angular.copy(e.evento)}e.changeDate=function(t){var n={date:new Date,mode:"datetime",minDate:ionic.Platform.isAndroid()?(new Date).getTime():new Date,allowOldDates:!1,is24Hour:!0,allowFutureDates:!0,doneButtonLabel:"OK",doneButtonColor:"#2ECC71",cancelButtonLabel:"Annulla",cancelButtonColor:"#CC0000"};if("fine"==t){var i=new Date(e.evento.data_inizio_evento);if(i.toDateString()>=(new Date).toDateString()){var a=new Date(e.evento.data_inizio_evento);a.setDate(a.getDate()+1),n.minDate=ionic.Platform.isAndroid()?new Date(a).getTime():new Date(a)}else n.minDate=ionic.Platform.isAndroid()?(new Date).getTime():new Date}e.evento.notifiche.pendenti.email||o.show(n).then(function(o){e.evento["data_"+t+"_evento"]=o,v=!0,e.eventoForm.$dirty=!0})},e.takePhoto=function(){var t={quality:100,correctOrientation:!0,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,targetWidth:1e3,targetHeight:760,saveToPhotoAlbum:!0};d.useCamera(t).then(function(t){e.evento.filename=t,v=!0,e.eventoForm.$dirty=!0},function(){e.eventoForm.$dirty=v})},e.getPhotoAlbum=function(){var t={quality:100,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,targetWidth:1e3,targetHeight:760};d.useCamera(t).then(function(t){e.evento.filename=t,v=!0,e.eventoForm.$dirty=!0},function(){e.eventoForm.$dirty=v})},e.removePhoto=function(){s(function(){e.evento.filename=m.filename.replace("/lg_","/xl_"),v=!0,e.eventoForm.$dirty=!0},0)},e.isEqual=function(){var t=angular.equals(h,angular.copy(e.evento));return v=!t,e.eventoForm.$dirty=v,t},e.create=function(t){var o=new Date(t.data_inizio_evento);o.setSeconds(0),o.setMilliseconds(0);var n=new Date(t.data_fine_evento);return n.setSeconds(0),n.setMilliseconds(0),o.getTime()>=n.getTime()?(r.alert({title:"Attenzione",template:"La data in cui termina l&apos;evento non pu&ograve; essere uguale o precendete al suo inizio!"}),!1):(i.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),void d.create(t).then(function(){e.eventoForm.$dirty=!1,i.hide(),c.goBack(-2),a.show("Evento creato con successo","short","bottom")},function(){i.hide(),a.show("Errore creazione evento","short","bottom")}))},e.update=function(t){var o=new Date(t.data_inizio_evento);o.setSeconds(0),o.setMilliseconds(0);var n=new Date(t.data_fine_evento);return n.setSeconds(0),n.setMilliseconds(0),o.getTime()>=n.getTime()?(r.alert({title:"Attenzione",template:"La data in cui termina l&apos;evento non pu&ograve; essere uguale o precendete al suo inizio!"}),!1):(i.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),changeImage=t.filename!=h.filename?!0:!1,void d.update(t,changeImage).then(function(){e.eventoForm.$dirty=!1,i.hide(),c.goBack(-2),a.show("Evento modificato con successo","short","bottom")},function(){i.hide(),a.show("Errore modifica evento","short","bottom")}))}}]);