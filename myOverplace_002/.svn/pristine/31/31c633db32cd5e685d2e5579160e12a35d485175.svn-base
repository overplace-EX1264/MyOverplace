angular.module("gallery.services",[]).factory("Gallery",["$http","$q","$cordovaCamera","$ionicPopup","ApiConfig","Cache",function(e,a,t,r,n){var i=this;return this.camera=function(e){var n=a.defer();return t.getPicture(e).then(function(a){var t=(document.getElementById("box-image-evento"),new Image);t.src="data:image/jpeg;base64,"+a,t.onload=function(){if(this.width<this.height){var t;t=e.hasOwnProperty("mediaType")&&0==e.mediaType?"La larghezza dell'immagine deve essere superiore alla sua altezza!<br>Scegli un'altra immagine.":"La larghezza dell'immagine deve essere superiore alla sua altezza!<br>Ruota lo smartphone.";var o=r.confirm({title:"Attenzione",template:t,okText:"OK",cancelText:"Annulla"});o.then(function(a){a&&i.camera(e)})}else n.resolve("data:image/jpeg;base64,"+a)}},function(e){"Selection cancelled."!=e&&"Camera cancelled."!=e&&"no image selected"!=e&&r.alert({title:"Attenzione",template:"L'immagine non pu&ograve; essere utilizzata in quanto non risiede fisicamente sul tuo device."}),n.reject()}),n.promise},{useCamera:function(e){var t=a.defer();return i.camera(e).then(function(e){t.resolve(e)},function(){t.reject()}),t.promise},create:function(t){var r=a.defer(),i=n.ovpEndpointHmac+"app/post/gallery/"+window.localStorage.id_scheda,o={filename:t.filename,moduli:t.moduli_selezionati,operation:"create"};return e({method:"POST",url:i,data:JSON.stringify(o).replace(/\//g,"\\/"),cache:!1,hmac:!0}).success(function(e){0!=e.hasOwnProperty("error")?r.reject():r.resolve(e)}).error(function(){r.reject()}),r.promise}}}]);