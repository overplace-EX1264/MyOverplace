angular.module("news.controllers",[]).controller("NewsCtrl",["$scope","$ionicPopup","$ionicLoading","$cordovaToast","$location","News","$timeout",function(e,t,n,o,i,a){e.news_list=[],e.isAvailable=!0,e.loadNews=function(){a.loadMore().then(function(t){e.news_list=t,e.isAvailable=a.getMoreStatus(),e.$broadcast("scroll.infiniteScrollComplete")},function(){o.show("Attenzione! Si è verificato un errore durante il caricamento","short","bottom"),e.$broadcast("scroll.infiniteScrollComplete")})},e.delete=function(e){var i="Sei sicuro di voler cancellare la news?";e.facebook&&e.twitter?i+=" Verranno eliminati anche i post su Facebook e Twitter.":e.facebook?i+=" Verrà eliminato anche il post su Facebook.":e.twitter&&(i+=" Verrà eliminato anche il post su Twitter.");var r=t.confirm({title:"Attenzione",template:i,okText:"Si",cancelText:"No"});r.then(function(t){t&&(n.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),a.delete(e).then(function(){n.hide(),o.show("News eliminata con successo","short","bottom")},function(){n.hide(),o.show("Errore eliminazione news","short","bottom")}))})},e.edit=function(e){i.path("/app/news/"+e+"/edit")},e.refresh=function(){a.refreshList().then(function(t){e.news_list=t,e.isAvailable=a.getMoreStatus(),e.$broadcast("scroll.refreshComplete")},function(){o.show("Errore nel recupero delle news!","short","bottom"),e.$broadcast("scroll.refreshComplete")})}}]).controller("NewsDetailCtrl",["$scope","$stateParams","$ionicHistory","$ionicPopup","$ionicLoading","$cordovaToast","News",function(e,t,n,o,i,a,r){e.news_list=r.getList(),e.news=r.get(t.id),e.delete=function(e){var t="Sei sicuro di voler cancellare la news?";e.facebook&&e.twitter?t+=" Verranno eliminati anche i post su Facebook e Twitter.":e.facebook?t+=" Verrà eliminato anche i post su Facebook.":e.twitter&&(t+=" Verrà eliminato anche i post su Twitter.");var c=o.confirm({title:"Attenzione",template:t,okText:"Si",cancelText:"No"});c.then(function(t){t&&(i.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),r.delete(e).then(function(){i.hide(),n.goBack(),a.show("News eliminata con successo","short","bottom")},function(){i.hide(),a.show("Errore eliminazione news","short","bottom")}))})}}]).controller("NewsOperationCtrl",["$scope","$stateParams","$cordovaDatePicker","$cordovaCamera","$ionicLoading","$cordovaToast","$ionicPopup","$ionicHistory","$timeout","$cordovaSocialSharing","Auth","News","ListeContatti",function(e,t,n,o,i,a,r,c,s,l,u,m){var d=u.getUserData(null);e.social=d.wmc_data.social,e.notifiche={messaggi:d.wmc_data.messaggi,app:d.wmc_data.app},e.notifiche_checkbox={email:0,sms:0},e.emptyListaContatti={email_disabled:!1,sms_disabled:!1};var p=c.currentView(),w=!1;switch(p.stateName){case"app.news-create":e.news=[],e.news.facebook=!1,e.news.twitter=!1,e.news.data_inizio_pubblicazione=(new Date).getTime(),e.news.filename="http://files.overplace.com/bacheca/xl_overplace.png",e.news.notifiche={pendenti:{email:0}};break;case"app.news-edit":e.news=m.get(t.id);var h=angular.copy(e.news)}e.changeDate=function(){var t={date:new Date,mode:"datetime",minDate:ionic.Platform.isAndroid()?(new Date).getTime():new Date,allowOldDates:!1,is24Hour:!0,allowFutureDates:!0,doneButtonLabel:"OK",doneButtonColor:"#2ECC71",cancelButtonLabel:"Annulla",cancelButtonColor:"#CC0000"};e.news.notifiche.pendenti.email||n.show(t).then(function(t){e.news.data_inizio_pubblicazione=t,w=!0,e.newsForm.$dirty=!0})},e.takePhoto=function(){var t={quality:100,correctOrientation:!0,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,targetWidth:1e3,targetHeight:760,saveToPhotoAlbum:!0};m.useCamera(t).then(function(t){e.news.filename=t,w=!0,e.newsForm.$dirty=!0},function(){e.newsForm.$dirty=w})},e.getPhotoAlbum=function(){var t={quality:100,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,targetWidth:1e3,targetHeight:760};m.useCamera(t).then(function(t){e.news.filename=t,w=!0,e.newsForm.$dirty=!0},function(){e.newsForm.$dirty=w})},e.removePhoto=function(){s(function(){e.news.filename="http://files.overplace.com/bacheca/xl_overplace.png",w=!0,e.newsForm.$dirty=!0},0)},e.isEqual=function(){var t=angular.equals(h,angular.copy(e.news));return w=!t,e.newsForm.$dirty=w,t},e.create=function(t){i.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),m.create(t).then(function(t){e.newsForm.$dirty=!1,i.hide(),c.goBack(),a.show("News creata con successo","short","bottom");var n=new Date(t.data_inizio_pubblicazione).getTime(),o=(new Date).getTime();o>=n&&window.plugins.socialsharing.canShareVia("whatsapp","msg",null,null,null,function(){r.confirm({title:"Condividi",template:"Vuoi condividere la news su WhatsApp?",okText:"Si",cancelText:"No"}).then(function(e){e&&l.shareViaWhatsApp(null,null,"https://www.overplace.com/landing/N"+d.id_scheda+"-"+t.id).then(function(){},function(){})})},function(){})},function(){i.hide(),a.show("Errore creazione news","short","bottom")})},e.update=function(t){i.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),changeImage=t.filename!=h.filename?!0:!1,m.update(t,changeImage).then(function(t){e.newsForm.$dirty=!1,i.hide(),c.goBack(-2),a.show("News modificata con successo","short","bottom");var n=new Date(t.data_inizio_pubblicazione).getTime(),o=(new Date).getTime();o>=n&&window.plugins.socialsharing.canShareVia("whatsapp","msg",null,null,null,function(){r.confirm({title:"Condividi",template:"Vuoi condividere la news su WhatsApp?",okText:"Si",cancelText:"No"}).then(function(e){e&&l.shareViaWhatsApp(null,null,"https://www.overplace.com/landing/N"+d.id_scheda+"-"+t.id).then(function(){},function(){})})},function(){})},function(){i.hide(),a.show("Errore modifica news","short","bottom")})}}]);