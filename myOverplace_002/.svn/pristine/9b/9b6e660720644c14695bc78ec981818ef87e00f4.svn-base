angular.module("gallery.controllers",[]).controller("GalleryCtrl",["$scope","$rootScope","$state","$cordovaCamera","$ionicLoading","$cordovaToast","$ionicScrollDelegate","$timeout","$ionicPopup","$ionicHistory","Auth","Gallery",function(e,o,i,a,t,l,n,r,c,u,d,m){var s=d.getUserData("wmc_data"),g=null;e.gallery={filename:null,moduli_attivi:[{id:"scheda",modulo:"Vetrina",checked:!1}],moduli_selezionati:[]},e.formInvalid=!0,e.create=function(o){t.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),m.create(o).then(function(){g=e.gallery.filename,e.clearForm(),t.hide(),l.show("Immagine caricata con successo","short","bottom"),n.scrollTop(!0),Instagram.isInstalled(function(e,o){o&&c.confirm({title:"Condividi",template:"Vuoi condividere la foto su Instagram?",okText:"Si",cancelText:"No"}).then(function(e){e&&Instagram.share(g,"",function(){g=null})})})},function(){t.hide(),l.show("Errore caricamento immagine","short","bottom")})},e.selectModulo=function(o){if(o.checked)e.gallery.moduli_selezionati.push(o.id);else{var i=e.gallery.moduli_selezionati.indexOf(o.id);i>-1&&e.gallery.moduli_selezionati.splice(i,1)}e.formInvalid=0==e.gallery.moduli_selezionati.length||null==e.gallery.filename},o.$on("$stateChangeStart",function(o,a){if(e.galleryForm.$dirty){o.preventDefault();var t=c.confirm({title:"Attenzione",template:"I dati non salvati andranno persi. Continuare?",okText:"Si",cancelText:"No"});t.then(function(t){t?(e.clearForm(),u.nextViewOptions({disableBack:!0}),i.go(a)):o.preventDefault()})}});for(var y in s.gallery)if(s.gallery[y])switch(y){case"prenotazioni":e.gallery.moduli_attivi.push({id:"booking",modulo:"Modulo Prenotazioni",checked:!1});break;case"booking":e.gallery.moduli_attivi.push({id:"hotel",modulo:"Modulo Booking",checked:!1});break;case"menu":e.gallery.moduli_attivi.push({id:"menu",modulo:"Modulo Menu",checked:!1});break;case"catalogo":e.gallery.moduli_attivi.push({id:"catalogo",modulo:"Modulo Catalogo",checked:!1});break;case"ricette":e.gallery.moduli_attivi.push({id:"ricetta",modulo:"Modulo Ricetta",checked:!1});break;case"storytelling":e.gallery.moduli_attivi.push({id:"storytelling",modulo:"Modulo Storytelling",checked:!1})}e.takePhoto=function(){var o={quality:100,correctOrientation:!0,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,targetWidth:1e3,targetHeight:760,saveToPhotoAlbum:!0};m.useCamera(o).then(function(o){e.galleryForm.$dirty=!0,e.gallery.filename=o,e.formInvalid=0==e.gallery.moduli_selezionati.length},function(){})},e.getPhotoAlbum=function(){var o={quality:100,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,targetWidth:1e3,targetHeight:760};m.useCamera(o).then(function(o){e.galleryForm.$dirty=!0,e.gallery.filename=o,e.formInvalid=0==e.gallery.moduli_selezionati.length},function(){})},e.removePhoto=function(){n.scrollTop(!0),r(function(){e.clearForm(),e.formInvalid=!0},500)},e.clearForm=function(){e.galleryForm.$dirty=!1,e.gallery.filename=null,e.gallery.moduli_selezionati=[];for(var o in e.gallery.moduli_attivi)e.gallery.moduli_attivi[o].checked=!1}}]);