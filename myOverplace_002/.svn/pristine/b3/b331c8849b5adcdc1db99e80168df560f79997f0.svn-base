angular.module("notifiche.services",[]).factory("Notifiche",["$http","$q","NavBadges","Cache",function(e,i,t,o){return o.notificheCache=void 0!==window.localStorage.notifiche&&JSON.parse(window.localStorage.notifiche).length>0?JSON.parse(window.localStorage.notifiche):[],o.notificheCacheId=void 0!==window.localStorage.notificheId&&Object.keys(JSON.parse(window.localStorage.notificheId)).length>0?JSON.parse(window.localStorage.notificheId):{},o.notificheCacheRead=void 0!==window.localStorage.notificheRead&&Object.keys(JSON.parse(window.localStorage.notificheRead)).length>0?JSON.parse(window.localStorage.notificheRead):{},t.setBadges("notifiche",Object.keys(o.notificheCacheRead).length),{getList:function(){var e=o.notificheCache;return e.reverse(),e},get:function(e){var i=o.notificheCacheId[e];if(0!=o.notificheCacheRead.hasOwnProperty(e)){for(var c in o.notificheCache)if(o.notificheCache[c].id==e){o.notificheCache[c].isRead=!0,delete o.notificheCacheRead[e];break}window.localStorage.notificheRead=JSON.stringify(o.notificheCacheRead),window.localStorage.notifiche=JSON.stringify(o.notificheCache),t.setBadges("notifiche",Object.keys(o.notificheCacheRead).length)}return i},addNotifica:function(e){for(var i in e){var c=e[i].customData,a={id:c.id,type:c.type,titolo:c.titolo,testo:c.testo,isRead:!1,testo_commento:c.testo_commento};0==o.notificheCacheId.hasOwnProperty(c.id)&&(o.notificheCache.unshift(a),o.notificheCacheId[c.id]=c,o.notificheCacheRead[c.id]=!0)}window.localStorage.notifiche=JSON.stringify(o.notificheCache),window.localStorage.notificheId=JSON.stringify(o.notificheCacheId),window.localStorage.notificheRead=JSON.stringify(o.notificheCacheRead),t.setBadges("notifiche",Object.keys(o.notificheCacheRead).length)},"delete":function(e){0!=o.notificheCacheRead.hasOwnProperty(e.id)&&(delete o.notificheCacheRead[e.id],window.localStorage.notificheRead=JSON.stringify(o.notificheCacheRead),t.setBadges("notifiche",Object.keys(o.notificheCacheRead).length)),-1!=o.notificheCache.indexOf(e)&&(o.notificheCache.splice(o.notificheCache.indexOf(e),1),delete o.notificheCacheId[e.id],window.localStorage.notifiche=JSON.stringify(o.notificheCache))}}}]);