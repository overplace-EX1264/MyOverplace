angular.module("convalide.controllers",[]).controller("ConvalideCtrl",["$scope","$ionicPopup","$cordovaToast","Convalide","Cache","$timeout",function(e,o,n,i,t,c){e.showDelete=!1,e.disableResync=void 0!==window.localStorage.convalideRemoved&&window.localStorage.convalideRemoved.length>0&&JSON.parse(window.localStorage.convalideRemoved).length>0?!1:!0,e.convalide_list=i.getList(),e.convalide_count=i.getTotalCount(),e.refresh=function(){i.refreshList().then(function(){e.convalide_list=t.convalideCache,e.convalide_count=i.getTotalCount(),e.$broadcast("scroll.refreshComplete")},function(){n.show("Errore nel recupero delle convalide!","short","bottom"),e.$broadcast("scroll.refreshComplete")})},e.delete=function(o,n){i.delete(o,n),e.disableResync=!1},e.resync=function(){o.confirm({title:"Ripristina notifiche",template:"Sei sicuro di voler ripristinare tutte le notifiche nascoste?",okText:"OK",cancelText:"Annulla"}).then(function(o){o&&(i.resync(),e.convalide_list=t.convalideCache,e.convalide_count=i.getTotalCount(),e.disableResync=!0)})},e.$watch(function(){return t.convalideCache},function(o,n){void 0!==o&&o!=n&&(e.convalide_list=o,c(function(){e.$digest()}))})}]).controller("ConvalideDetailCtrl",["$scope","$stateParams","$ionicHistory","$ionicPopup","$ionicLoading","Convalide","Cache",function(e,o,n,i,t,c,a){function l(e,o,a,l){i.confirm({title:a,template:l,okText:"OK",cancelText:"Annulla"}).then(function(i){i&&(t.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),c.move(e,o).then(function(){t.hide(),n.goBack()},function(){t.hide(),n.goBack()}))})}e.convalida=a.convalideCacheId[o.id],e.convalida_checkin=function(e){l(e,!0,"Promozione","Sei sicuro di voler convalidare la promozione?")},e.accetta_prenotazione=function(e){l(e,!0,"Prenotazione","Sei sicuro di voler accettare la prenotazione?")},e.rifiuta_prenotazione=function(e){l(e,!1,"Prenotazione","Sei sicuro di voler rifiutare la prenotazione?")}}]);