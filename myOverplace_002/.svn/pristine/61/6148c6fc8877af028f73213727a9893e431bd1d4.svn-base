angular.module("riepilogo.services",[]).factory("Riepilogo",["$http","$q","ApiConfig","Cache",function(e,o,i,r){var t=this;return t.month=0,r.riepilogoCache={},t.getAll=function(){var n=o.defer(),c={},l=i.ovpEndpoint+"riepilogo/"+window.localStorage.id_scheda+"/"+t.month+"/fields";return c[i.wsKey]="JSON_CALLBACK",c.nocache=(new Date).getTime(),e({method:"JSONP",url:l,params:c,cache:!1}).success(function(e){r.riepilogoCache=e,n.resolve(r.riepilogoCache)}).error(function(){n.reject()}),n.promise},{getList:function(){return void 0!=r.riepilogoCache&&Object.keys(r.riepilogoCache).length>0?r.riepilogoCache:this.refreshList()},get:function(e){var o={periodo:r.riepilogoCache.periodo,dati:r.riepilogoCache.dati[e],soglie:r.riepilogoCache.soglie[e],esito:r.riepilogoCache.esito.dettaglio[e]};return o},refreshList:function(){var e=o.defer();return t.getAll().then(function(o){e.resolve(o)},function(){e.reject()}),e.promise},changePeriod:function(e){t.month=0>e?0:e;var i=o.defer();return t.getAll().then(function(e){i.resolve(e)},function(){i.reject()}),i.promise}}}]);