angular.module("promozioni.controllers",[]).controller("PromozioniCtrl",["$scope","$ionicPopup","$ionicLoading","$cordovaToast","$location","$timeout","Auth","Promozioni","Help","initial",function(o,i,t,n,r,e,a,s,p,c){var l=a.getUserData(null);o.moduloPromozioni=l.wmc_data.promozioni,o.isSupport=Object.keys(l.support).length>0,o.isSupport&&(o.support_phone=l.support.phone),o.moduloPromozioni?o.promozioni_list=c:o.inactive=p.getModulo("promozioni"),o.call=function(o){window.location.href="tel:"+o},o.edit=function(o){r.path("/app/promozioni/"+o+"/edit")},o.refresh=function(){o.promozioni_list=[],s.refreshList().then(function(i){e(function(){o.promozioni_list=i,o.$broadcast("scroll.refreshComplete")})},function(){n.show("Errore nel recupero della promozione!","short","bottom"),o.$broadcast("scroll.refreshComplete")})}}]).controller("PromozioniOperationCtrl",["$scope","$stateParams","$ionicLoading","$cordovaToast","$ionicPopup","$ionicHistory","Auth","Promozioni","ListeContatti",function(o,i,t,n,r,e,a,s){var p=a.getUserData("wmc_data");o.social=p.social,o.notifiche={messaggi:p.messaggi,app:p.app},o.notifiche_checkbox={email:0,sms:0},o.emptyListaContatti={email_disabled:!1,sms_disabled:!1};var c=(e.currentView(),!1);o.promozione=s.get(i.id);var l=angular.copy(o.promozione);o.isEqual=function(){var i=angular.equals(l,angular.copy(o.promozione));return c=!i,o.promozioneForm.$dirty=c,i},o.update=function(i){t.show({template:"<ion-spinner></ion-spinner>",noBackdrop:!1}),s.update(i).then(function(){o.promozioneForm.$dirty=!1,t.hide(),e.goBack(-1),n.show("Promozione modificata con successo","short","bottom")},function(){t.hide(),n.show("Errore modifica promozione","short","bottom")})}}]);