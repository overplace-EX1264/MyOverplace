angular.module("chat.controllers",[]).controller("ChatCtrl",["$scope","$rootScope","$ionicLoading","Auth","Chats","Help",function(e,n,t,a,o,r){var c=a.getUserData(null);e.moduloChat=c.wmc_data.chat,e.isSupport=Object.keys(c.support).length>0,e.isSupport&&(e.support_phone=c.support.phone),e.moduloChat?(t.show({content:"Loading Data",animation:"fade-in",showBackdrop:!1,maxWidth:200}),e.Loading=!0,o.all().then(function(e){t.hide(),n.chats=e})):e.inactive=r.getModulo("chat"),e.call=function(e){window.location.href="tel:"+e},e.$watch(e.chats,function(){e.Loading=!1}),e.minusCounter=function(e){o.minusCounter(e)},e.remove=function(e){o.minusCounter(e.channelReference),o.remove(e)}}]).controller("ChatDetailCtrl",["$scope","$stateParams","$ionicScrollDelegate","$timeout","$state","$cordovaToast","Auth","Chats",function(e,n,t,a,o,r,c,l){var s=c.getUserData(null);e.myResponse="",e.currentChannel="","app.chat-read"==o.current.name&&void 0!==n.channelReference&&(e.currentChannel=n.channelReference),e.talk=l.get(n.channelReference),e.chatName=l.getName(n.channelReference),a(function(){t.scrollBottom()},1),e.sendResponse=function(t){if(""!==e.myResponse){e.myResponse="";var a={nickname:s.nickname,text:t,avatar:"//www.overplace.com/avatar/"+s.avatar};l.sendResponse(a,n.channelReference)}},e.$on("newMessage",function(n,a){"app.chat-read"==o.current.name&&a==e.currentChannel&&(l.minusCounter(a),l.resetPending(e.currentChannel),t.scrollBottom(!0))}),e.$on("chatClosed",function(n,t){"app.chat-read"==o.current.name&&t==e.currentChannel&&(r.show("Chat interrotta","short","bottom"),l.minusCounter(t))})}]);